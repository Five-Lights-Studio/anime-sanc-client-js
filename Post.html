<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AS/Post</title>
    <link rel="stylesheet" href="css/postStyle.css">
</head>

<body>
    <!DOCTYPE html>
    <html lang="ko">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AS/Post</title>
        <link rel="stylesheet" href="css/postStyle.css">
    </head>

    <body>
        <div class="dropdown-sandbox">
            <button onclick="toggleSandbox()">&#9664;</button>
            <div class="sandbox-content">
                <img src="/icon/user.png" alt="Profile-dummyPic" class="profile-pic">
                <h3>インティメート・マージャーのData Driven NOTE</h3>
                <p>元々は起業志向がある、いわゆる意識高い大学生。学ぶことが好きで、常に新しい知識を求めている</p>
            </div>
        </div>

        <header>
            <div class="logo"><a href="/index.html">Anime Sanctuary</a></div>
            <div class="search-container">
                <input type="text" class="search-bar" placeholder="キーワードやクリエイターで検索">
                <button class="search-button">検索</button>
            </div>
            <div class="header-icons">
                <div class="icon1">
                    <img src="/icon/free-icon-alarm-bell-6367716.png" alt="icon-1">
                </div>
                <div class="icon2">
                    <img src="/icon/user.png" onclick="toggleDropdown()" alt="icon2-user">
                    <!-- 드롭다운 메뉴 추가 -->
                    <div id="dropdown" class="dropdown-content">
                        <a href="#">プロフィール</a>
                        <a href="#">設定</a>
                        <a href="#">お知らせ</a>
                        <a href="#">メッセージ</a>
                        <a href="#">ログアウト</a>
                    </div>
                </div>
                <button class="post-button">投稿</button>
            </div>
        </header>

        <main class="container">
            <section class="post">
                <div class="post-image">
                    <img src="/image/random8.jpg" alt="Post Image">
                </div>
                <div class="post-header">
                    <img src="/icon/user.png" alt="Profile Picture" class="profile-pic">
                    <div class="profile-info">
                        <h3>tanaka</h3>
                        <p>25歳。旅と読書と自然が好き。建築やアートも。自由気ままに生きてる。</p>
                        <div class="post-meta">
                            <span>95 likes</span>
                            <span>2024年8月25日 13:42</span>
                        </div>
                    </div>
                </div>
                <div class="post-content">
                    <h2 class="title">あなたは中学校の国語の教師です。生成AIが書いた読書感想文を見破れますか？</h2>
                    <div class="dropdown-menu">
                        <button>目標</button>
                        <div class="dropdown-menu-content">
                            <a href="#">List text 1</a>

                            <a href="#">List text 2</a>
                            <a href="#">List text 3</a>
                            <a href="#">List text 4</a>
                            <a href="#">List text 5</a>
                        </div>
                        <p class="contents">
                            これはテスト用の文です。意味はありません。これはテスト用の文です。意味はありません。これはテスト用の文です。意味はありません。これはテスト用の文です。意味はありません。</p>
                    </div>

                    <br>
                    <div class="post-icons">
                        <img src="/icon/heart-fill.svg" alt="Like Icon" class="post-icon like"
                            onclick="toggleIconColor(this, 'like')">
                        <div>432</div>

                        <!-- 공유 버튼 SVG 아이콘 -->
                        <div class="post-icon share" id="shareBtn" onclick="toggleIconColor(this, 'share')">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" height="24"
                                width="24">
                                <path d="M14 8.5V4.5L21 11.5L14 18.5V14.4C9 14.4 5.5 16 3 19.5C4 14.5 7 9.5 14 8.5Z">
                                </path>
                            </svg>
                        </div>

                        <!-- 팝업 메뉴 -->
                        <div class="popup-menu" id="popupMenu">
                            <a href="#" id="copyLink">링크를 복사</a>
                            <a href="#" id="shareTwitter">Twitter로 공유</a>
                            <a href="#" id="shareLine">LINE으로 공유</a>
                            <a href="#" id="shareFacebook">Facebook으로 공유</a>
                        </div>

                        <img src="/icon/bookmark-plus-fill.svg" alt="Bookmark Icon" class="post-icon bookmark"
                            onclick="toggleIconColor(this, 'bookmark')">
                        <img src="/icon/etc.svg" alt="More Icon" class="post-icon more"
                            onclick="toggleIconColor(this, 'more')">
                    </div>

                </div>

                <div class="profile-section">
                    <img src="/image/userimage.png" alt="Thumbnail Image" class="profile-thumbnail">
                    <div class="profile-info">
                        <h3>AnimeSantuary公式</h3>
                        <p>「人間ではないもの」とは誰か：戦争とモダニズムの詩学』(青土社)、詩集『遠さについて特装版』発売中！ 詩歌／哲学／創作</p>
                        <button class="follow-button" onclick="toggleFollow(this)">フォロー</button>
                    </div>
                </div>
                </div>
                <!--0907 댓글창수정-->
                <div class="comments-section">
                    <h3>コメント</h3>
                    <div class="comment">
                        <img src="/icon/user.png" alt="Profile Icon" class="comment-icon">
                        <div class="comment-content">
                            <span class="comment-username">ユーザー1</span>
                            <p>本内容はテスト用です。</p>
                            <span class="comment-date">2024年9月7日 14:30</span>
                        </div>
                    </div>
                    <div class="comment">
                        <img src="/icon/user.png" alt="Profile Icon" class="comment-icon">
                        <div class="comment-content">
                            <span class="comment-username">ユーザー2</span>
                            <p>本内容はテスト用です。</p>
                            <span class="comment-date">2024年9月7日 14:32</span>
                        </div>
                    </div>
                    <div class="comment">
                        <img src="/icon/user.png" alt="Profile Icon" class="comment-icon">
                        <div class="comment-content">
                            <span class="comment-username">ユーザー3</span>
                            <p>本内容はテスト用です。</p>
                            <span class="comment-date">2024年9月7日 14:35</span>
                        </div>
                    </div>

                    <!-- 페이지네이션 -->
                    <div class="pagination">
                        <button class="pagination-arrow" onclick="prevPage()">&#9664;</button>
                        <div class="pagination-numbers">
                            <!-- 페이지 번호 버튼 -->
                        </div>
                        <button class="pagination-arrow" onclick="nextPage()">&#9654;</button>
                    </div>
                </div>
                <!-- 페이지네이션 끝-->

                <button class="toggle-comment-button" onclick="toggleCommentBox()">コメント覧を開く</button>

                <!-- 댓글 작성 창 -->
                <div id="comment-box" class="comment-box">
                    <textarea id="comment-input" maxlength="200" placeholder="コメントを入力してください..."></textarea>
                    <div class="comment-box-footer">
                        <span id="char-count">0/200</span>
                        <button onclick="submitComment()">確認</button>
                    </div>
                </div>

                </div>

                <!--0907 수정끝-->
                <!-- 인기 기사 섹션 -->
                <div class="additional-content">
                    <h3>人気記事</h3>
                    <div class="content-item">
                        <div>シンプルな操作画面は変わらず、機能はパワーアップ！みなさんの記事編集画面が新しくなります</div>
                        <div class="post-icons">
                            <img src="/icon/heart-fill.svg" alt="Like Icon" class="post-icon like"
                                onclick="toggleIconColor(this, 'like')">
                            <div>3,851</div>
                        </div>
                    </div>
                    <div class="content-item">
                        <div>インターネットでの発信に、もっと安心を。#note10周年</div>
                        <div class="post-icons">
                            <img src="/icon/heart-fill.svg" alt="Like Icon" class="post-icon like"
                                onclick="toggleIconColor(this, 'like')">
                            <div>2,094</div>
                        </div>
                    </div>
                    <div class="content-item">
                        <div>noteはより多様なクリエイターを応援していきます</div>
                        <div class="post-icons">
                            <img src="/icon/heart-fill.svg" alt="Like Icon" class="post-icon like"
                                onclick="toggleIconColor(this, 'like')">
                            <div>3,509</div>
                        </div>
                    </div>
                    <br>
                    <div class="view-all">すべて見る</div>

                    <!-- 이전/다음 기사 섹션 수정 -->
                    <div class="post-navigation">
                        <div class="prev-article" onclick="navigateToPrevious()">
                            <!-- 왼쪽 방향 삼각형 추가 -->
                            <span>&#9664; 前の記事</span>
                            <p>Macで完全ローカルで1万6千字の記事の作成から日本語訳まで行う</p>
                        </div>
                        <div class="next-article" onclick="navigateToNext()">
                            <!-- 오른쪽 방향 삼각형 추가 -->
                            <span>次の記事 &#9654;</span>
                            <p>今そこにある酒</p>
                        </div>
                    </div>


            </section>


        </main>

    </body>
    <!-- 기타 HTML 요소 생략 -->
    <script src="javascript/share.js"></script>
    <script>
        // URL에서 게시물 ID를 가져오는 함수
        function getPostIdFromURL() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get("id"); // ★ URL에서 ID 추출
            console.log('Fetched ID:', id); // ★ 콘솔에 ID를 찍어보기
            return id;
        }

        // 서버에서 특정 게시물 데이터를 가져오는 함수
        async function fetchPostById(id) {
            try {
                const response = await fetch(`http://localhost:9000/api/notes/${id}`); // ★ GET 요청으로 특정 ID의 게시물 데이터를 가져옴
                if (!response.ok) {
                    throw new Error(`Failed to fetch post: ${response.status}`); // 서버 응답 오류가 있는 경우 오류 메시지와 상태 코드를 표시합니다.
                }
                const post = await response.json();

                // 페이지에 게시물 데이터 표시
                document.querySelector('h2.title').textContent = post.title || '제목을 찾을 수 없습니다'; // 서버에서 받아온 제목을 표시합니다.
                document.querySelector('p.contents').textContent = post.contents || '내용을 찾을 수 없습니다'; // 서버에서 받아온 내용을 표시합니다.
            } catch (error) {
                console.error("Error fetching post:", error); // 오류 발생 시 콘솔에 출력
                alert("게시물 데이터를 불러오는 중 오류가 발생했습니다."); // 사용자에게 오류 알림
            }
        }

        // 페이지 로드 시 게시물 ID를 추출하고 데이터를 가져오는 함수 호출
        document.addEventListener("DOMContentLoaded", function () {
            const postId = getPostIdFromURL();
            if (postId) {
                fetchPostById(postId); // ★ 페이지 로드 시 ID를 사용해 데이터 요청
            } else {
                alert("게시물 ID를 찾을 수 없습니다."); // ID가 없을 경우 사용자에게 알림
            }
        });



        //여기부터 댓글창
        function toggleCommentBox() {
            const commentBox = document.getElementById('comment-box');
            const toggleButton = document.querySelector('.toggle-comment-button');

            if (commentBox.style.display === 'block') {
                commentBox.style.display = 'none';
                toggleButton.textContent = 'コメント覧を開く';
            } else {
                commentBox.style.display = 'block';
                toggleButton.textContent = 'コメント覧を閉じる';
            }
        }

        document.getElementById('comment-input').addEventListener('input', function () {
            const charCount = this.value.length;
            document.getElementById('char-count').textContent = `${charCount}/200`;
        });

        function submitComment() {
            const commentInput = document.getElementById('comment-input');
            const newCommentText = commentInput.value.trim();
            if (newCommentText === "") {
                alert("コメントを入力してください。");
                return;
            }

            // 새로운 댓글 요소 추가
            const newComment = document.createElement('div');
            newComment.classList.add('comment');
            newComment.innerHTML = `
        <img src="/icon/user.png" alt="Profile Icon" class="comment-icon">
        <div class="comment-content">
            <span class="comment-username">新しいユーザー</span>
            <p>${newCommentText}</p>
            <span class="comment-date">2024年9月7日 15:00</span>
        </div>
    `;
            document.querySelector('.comments-section').appendChild(newComment);

            // 댓글 창 닫기 및 초기화
            toggleCommentBox();
            commentInput.value = "";
            document.getElementById('char-count').textContent = '0/200';
        }

        //페이지네이션 -필요없을지 여기서부터 삭제 
        let currentPageSet = 1; // 현재 페이지 세트 (1~5, 6~10 등)
        const totalPages = 10; // 총 페이지 수
        const pagesPerSet = 5; // 한 세트 당 페이지 수

        function renderPagination() {
            const paginationNumbers = document.querySelector('.pagination-numbers');
            paginationNumbers.innerHTML = ''; // 기존 페이지 번호 초기화

            const startPage = (currentPageSet - 1) * pagesPerSet + 1;
            const endPage = Math.min(startPage + pagesPerSet - 1, totalPages);

            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.classList.add('page-button');
                if (i === startPage) pageButton.classList.add('active'); // 첫 페이지를 기본 활성화

                pageButton.onclick = function () {
                    document.querySelectorAll('.page-button').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    // 페이지 번호에 따른 댓글 표시 기능 추가
                };
                paginationNumbers.appendChild(pageButton);
            }
        }

        function prevPage() {
            if (currentPageSet > 1) {
                currentPageSet--;
                renderPagination();
            }
        }

        function nextPage() {
            if (currentPageSet < Math.ceil(totalPages / pagesPerSet)) {
                currentPageSet++;
                renderPagination();
            }
        }

        // 페이지 로드 시 초기 페이지네이션 렌더링
        document.addEventListener('DOMContentLoaded', function () {
            renderPagination();
        });

        // 공유 버튼 및 팝업 메뉴 엘리먼트 선택
        const shareBtn = document.getElementById('shareBtn');
        const popupMenu = document.getElementById('popupMenu');

        // 공유 버튼 클릭 시 팝업 메뉴 토글
        shareBtn.addEventListener('click', () => {
            popupMenu.classList.toggle('active');
        });

        // 다른 곳을 클릭하면 팝업 메뉴 닫기
        document.addEventListener('click', function (event) {
            if (!shareBtn.contains(event.target) && !popupMenu.contains(event.target)) {
                popupMenu.classList.remove('active');
            }
        });

        // 각 공유 링크에 대한 동작 정의
        document.getElementById('copyLink').addEventListener('click', (event) => {
            event.preventDefault();
            const pageUrl = window.location.href;
            navigator.clipboard.writeText(pageUrl);
            alert('링크가 복사되었습니다!');
        });

        document.getElementById('shareTwitter').addEventListener('click', (event) => {
            event.preventDefault();
            const pageUrl = window.location.href;
            window.open(`https://twitter.com/intent/tweet?url=${pageUrl}`);
        });

        document.getElementById('shareLine').addEventListener('click', (event) => {
            event.preventDefault();
            const pageUrl = window.location.href;
            window.open(`https://social-plugins.line.me/lineit/share?url=${pageUrl}`);
        });

        document.getElementById('shareFacebook').addEventListener('click', (event) => {
            event.preventDefault();
            const pageUrl = window.location.href;
            window.open(`http://www.facebook.com/sharer/sharer.php?u=${pageUrl}`);
        });
    </script>
</body>

</html>